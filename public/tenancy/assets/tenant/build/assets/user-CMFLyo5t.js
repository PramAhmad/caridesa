$(function(){const l=window.LaravelDataTables["user-table"];$(".btn-add-user").on("click",function(){$(".modal-title").text("Add User")}),$(".select-role").select2({dropdownParent:$("#modal-user"),placeholder:"Select Role",width:"100%"}),$("table.dataTable tbody").on("click","tr td .btn-edit",function(){const s=$(this);$.ajax({type:"POST",url:`${baseUrl}/user/${s.data("id")}/edit`,data:{id:s.data("id")},beforeSend:function(){s.html('<div class="spinner-border spinner-border-sm" user="status"></div>').prop("disabled",!0)},success:function(e){$(".modal-title").text("Edit User"),$("#modal-user").modal("show"),$(".modal form").find("input[type=password]").removeAttr("required"),$.each(e.data,function(r,o){$(".modal form").find(`input[name=${r}],select[name="${r}"],textarea[name="${r}"`).val(o)}),$(".modal-content").find(".btn-save").attr("data-id",s.data("id")),$(".select-role").val(e.data.role).change()},complete:function(){s.html('<i class="ti ti-pencil"></i>').prop("disabled",!1)},error:function(e,r,o){e.responseJSON?e.responseJSON.errors?$.each(e.responseJSON.errors,function(t,d){let a=`input[name="${t}"],select[name="${t}"],textarea[name="${t}"]`;t.match(/\./g)&&(a=`input[data-name="${t}"],select[data-name="${t}"],textarea[data-name="${t}"]`),$("form").find(a).closest("div").append(`<div class="w-100"><small class="error-message text-danger">${d}</small></div>`)}):toastr.error(`${e.responseJSON.message}`,"Oops"):toastr.error(`${e.responseJSON.message}`,"Oops")}})}),$(".btn-save").on("click",function(){$(this).closest("div.modal-content").find("form").submit()}),$("form").on("submit",function(s){s.preventDefault();const e=$(this),r=e.closest("div.modal-content").find(".btn-save"),o=r.attr("data-id"),t=o?`${baseUrl}/user/${o}/edit`:`${baseUrl}/user`;let d=new FormData(e[0]);if(o&&d.append("_method","PUT"),!e[0].checkValidity())return e[0].reportValidity();$.ajax({type:"POST",url:t,data:d,contentType:!1,processData:!1,beforeSend:function(){r.html('<div class="spinner-border spinner-border-sm" user="status"></div>').prop("disabled",!0),e.find(".error-message").remove()},success:function(a){l.ajax.reload(),$(".modal").modal("hide"),toastr.success(`${a.message}`,"Success")},complete:function(){r.html('<i class="mdi mdi-content-save"></i> Simpan').prop("disabled",!1)},error:function(a,m,u){a.responseJSON?a.responseJSON.errors?$.each(a.responseJSON.errors,function(n,c){let i=`input[name="${n}"],select[name="${n}"],textarea[name="${n}"]`;n.match(/\./g)&&(i=`input[data-name="${n}"],select[data-name="${n}"],textarea[data-name="${n}"]`),e.find(i).closest("div").append(`<div class="w-100"><small class="error-message text-danger">${c}</small></div>`)}):toastr.error(`${a.responseJSON.message}`,"Oops"):toastr.error("","Oops")}})}),$(".modal").on("hidden.bs.modal",function(){$(".modal form")[0].reset(),$(".modal-content").find(".btn-save").removeAttr("data-id"),$(".modal form").find("input[type=password]").attr("required",!0)}),$(".search-datatable").on("keyup keydown change",function(){l.search(this.value).draw()})});
