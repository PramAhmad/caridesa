$(function(){const l=window.LaravelDataTables["role-table"];$(".btn-add-role").on("click",function(){$(".modal-title").text("Add Role")}),$("table.dataTable tbody").on("click","tr td .btn-edit",function(){const s=$(this);$.ajax({type:"POST",url:`${baseUrl}/role/${s.data("id")}/edit`,data:{id:s.data("id")},beforeSend:function(){s.html('<div class="spinner-border spinner-border-sm" role="status"></div>').prop("disabled",!0)},success:function(e){$(".modal-title").text("Edit Role"),$("#modal-role").modal("show"),$.each(e.data,function(n,r){$(".modal form").find(`input[name=${n}]`).val(r),$(".modal-content").find(".btn-save").attr("data-id",s.data("id"))})},complete:function(){s.html('<i class="ti ti-pencil"></i>').prop("disabled",!1)},error:function(e,n,r){e.responseJSON?e.responseJSON.errors?$.each(e.responseJSON.errors,function(t,d){let a=`input[name="${t}"],select[name="${t}"],textarea[name="${t}"]`;t.match(/\./g)&&(a=`input[data-name="${t}"],select[data-name="${t}"],textarea[data-name="${t}"]`),$("form").find(a).closest("div").append(`<div class="w-100"><small class="error-message text-danger">${d}</small></div>`)}):toastr.error(`${e.responseJSON.message}`,"Oops"):toastr.error(`${e.responseJSON.message}`,"Oops")}})}),$(".btn-save").on("click",function(){$(this).closest("div.modal-content").find("form").submit()}),$("form").on("submit",function(s){s.preventDefault();const e=$(this),n=e.closest("div.modal-content").find(".btn-save"),r=n.attr("data-id"),t=r?`${baseUrl}/role/${r}/edit`:`${baseUrl}/role`;let d=new FormData(e[0]);if(r&&d.append("_method","PUT"),!e[0].checkValidity())return e[0].reportValidity();$.ajax({type:"POST",url:t,data:d,contentType:!1,processData:!1,beforeSend:function(){n.html('<div class="spinner-border spinner-border-sm" role="status"></div>').prop("disabled",!0),e.find(".error-message").remove()},success:function(a){l.ajax.reload(),$(".modal").modal("hide"),toastr.success(`${a.message}`,"Success")},complete:function(){n.html('<i class="mdi mdi-content-save"></i> Simpan').prop("disabled",!1)},error:function(a,m,f){a.responseJSON?a.responseJSON.errors?$.each(a.responseJSON.errors,function(o,c){let i=`input[name="${o}"],select[name="${o}"],textarea[name="${o}"]`;o.match(/\./g)&&(i=`input[data-name="${o}"],select[data-name="${o}"],textarea[data-name="${o}"]`),e.find(i).closest("div").append(`<div class="w-100"><small class="error-message text-danger">${c}</small></div>`)}):toastr.error(`${a.responseJSON.message}`,"Oops"):toastr.error("","Oops")}})}),$(".modal").on("hidden.bs.modal",function(){$(".modal form")[0].reset(),$(".modal-content").find(".btn-save").removeAttr("data-id")}),$(".search-datatable").on("keyup keydown change",function(){l.search(this.value).draw()})});
