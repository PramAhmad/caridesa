$(function(){const l=window.LaravelDataTables["lead-table"];initDaterange(),$(".btn-add-lead").on("click",function(){$(".modal-title").text("Tambah Lead")}),$("table.dataTable tbody").on("click","tr td .btn-edit",function(){const s=$(this);$.ajax({type:"POST",url:`${baseUrl}/lead/${s.data("id")}/edit`,data:{id:s.data("id")},beforeSend:function(){s.html('<div class="spinner-border spinner-border-sm" role="status"></div>').prop("disabled",!0)},success:function(e){$(".modal-title").text("Edit Lead"),$("#modal-lead").modal("show"),$.each(e.data,function(n,d){$(".modal form").find(`input[name="${n}"],select[name="${n}"],textarea[name="${n}"]`).val(d)}),$(".modal-content").find(".btn-save").attr("data-id",s.data("id"))},complete:function(){s.html('<i class="ti ti-pencil"></i>').prop("disabled",!1)},error:function(e,n,d){e.responseJSON?e.responseJSON.errors?$.each(e.responseJSON.errors,function(t,i){let a=`input[name="${t}"],select[name="${t}"],textarea[name="${t}"]`;t.match(/\./g)&&(a=`input[data-name="${t}"],select[data-name="${t}"],textarea[data-name="${t}"]`),$("form").find(a).addClass("is-invalid"),$("form").find(a).closest("div").append(`<div class="invalid-feedback">${i}</div>`)}):toastr.error(`${e.responseJSON.message}`,"Oops"):toastr.error(`${e.responseJSON.message}`,"Oops")}})}),$(".btn-save").on("click",function(){$(this).closest("div.modal-content").find("form").submit()}),$("form").on("submit",function(s){s.preventDefault();const e=$(this),n=e.closest("div.modal-content").find(".btn-save"),d=n.attr("data-id"),t=d?`${baseUrl}/lead/${d}/edit`:`${baseUrl}/lead`;let i=new FormData(e[0]);if(d&&i.append("_method","PUT"),!e[0].checkValidity())return e[0].reportValidity();$.ajax({type:"POST",url:t,data:i,contentType:!1,processData:!1,beforeSend:function(){n.html('<div class="spinner-border spinner-border-sm" lead="status"></div>').prop("disabled",!0),e.find(".is-invalid").removeClass("is-invalid"),e.find(".invalid-feedback").remove()},success:function(a){l.ajax.reload(),$(".modal").modal("hide"),toastr.success(`${a.message}`,"Success")},complete:function(){n.html('<i class="mdi mdi-content-save"></i> Simpan').prop("disabled",!1)},error:function(a,m,f){a.responseJSON?a.responseJSON.errors?$.each(a.responseJSON.errors,function(o,c){let r=`input[name="${o}"],select[name="${o}"],textarea[name="${o}"]`;o.match(/\./g)&&(r=`input[data-name="${o}"],select[data-name="${o}"],textarea[data-name="${o}"]`),$("form").find(r).addClass("is-invalid"),$("form").find(r).closest("div").append(`<div class="invalid-feedback">${c}</div>`)}):toastr.error(`${a.responseJSON.message}`,"Oops"):toastr.error("","Oops")}})}),$(".modal").on("hidden.bs.modal",function(){$(".modal form")[0].reset(),$(".modal-content").find(".btn-save").removeAttr("data-id"),$(".modal-content").find("input,select,textarea").removeClass("is-invalid")})});
